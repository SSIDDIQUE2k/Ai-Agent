<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Virtual Assistant</title>
  <style>
    :root {
      --accent: #007bff;
      --accent-hover:#0056d1;
      --bg-light:#f7f9fc;
      --bubble-user:#e1f3ff;
      --bubble-bot:#f1f1f1;
    }
    *{box-sizing:border-box;margin:0;padding:0}
    body{font-family:Arial,Helvetica,sans-serif}
    /* launcher */
    #chat-launcher{position:fixed;bottom:20px;right:20px;display:flex;align-items:center;background:var(--accent);color:#fff;border:none;border-radius:50px;padding:10px 20px;cursor:pointer;box-shadow:0 4px 12px rgba(0,0,0,.15);z-index:1000;gap:8px;transition:background .2s}
    #chat-launcher:hover{background:var(--accent-hover)}
    #chat-launcher img{width:32px;height:32px;border-radius:50%}
    /* window */
    #chat-window{position:fixed;bottom:80px;right:20px;width:320px;max-height:85vh;background:#fff;border:1px solid #ddd;border-radius:10px;box-shadow:0 6px 24px rgba(0,0,0,.2);display:flex;flex-direction:column;overflow:hidden;transform:scale(.8);opacity:0;pointer-events:none;transition:transform .3s,opacity .3s;z-index:1000}
    #chat-window.show{transform:scale(1);opacity:1;pointer-events:auto}
    @media(max-width:400px){#chat-window{right:10px;width:90vw}}
    /* header */
    #chat-header{background:var(--accent);color:#fff;padding:10px;font-weight:700;display:flex;justify-content:space-between;align-items:center}
    #close-btn{cursor:pointer;font-size:18px;opacity:.7;user-select:none}
    #close-btn:hover{opacity:1}
    /* body */
    #chat-body{flex:1;overflow-y:auto;padding:10px;background:var(--bg-light)}
    .msg{margin:8px 0;display:flex}
    .msg.user{justify-content:flex-end}
    .bubble{max-width:75%;padding:8px 12px;border-radius:16px;line-height:1.35}
    .user .bubble{background:var(--bubble-user)}
    .bot  .bubble{background:var(--bubble-bot)}
    /* typing dots */
    .typing{display:flex;gap:3px;padding:8px 12px;border-radius:16px;background:var(--bubble-bot)}
    .typing span{width:6px;height:6px;border-radius:50%;background:#888;animation:blink 1s infinite}
    .typing span:nth-child(2){animation-delay:.15s}
    .typing span:nth-child(3){animation-delay:.3s}
    @keyframes blink{0%,100%{opacity:.2}50%{opacity:1}}
    /* input */
    #chat-input{border-top:1px solid #ddd;display:flex}
    #user-input{flex:1;border:none;padding:10px;font-size:14px}
    #send-btn{border:none;background:var(--accent);color:#fff;padding:0 16px;font-size:14px;cursor:pointer;transition:background .2s}
    #send-btn:hover{background:var(--accent-hover)}
    #send-btn:disabled{opacity:.6;cursor:default}
  </style>
</head>
<body>
<button id="chat-launcher" aria-haspopup="dialog" aria-controls="chat-window" aria-expanded="false">
  <img src="https://i.pravatar.cc/32" alt="Agent avatar"><span>Chat with us</span>
</button>

<!-- Chat Window -->
<section id="chat-window" role="dialog" aria-label="Virtual assistant">
  <header id="chat-header">
    <span>Virtual Assistant</span>
    <span id="close-btn" title="Close chat" aria-label="Close chat">&times;</span>
  </header>
  <main id="chat-body"></main>
  <form id="chat-input" autocomplete="off">
    <input id="user-input" placeholder="Type your messageâ€¦" aria-label="Message">
    <button id="send-btn" type="submit">Send</button>
  </form>
</section>

<script>
(function(){
 const launcher=document.getElementById('chat-launcher');
 const win=document.getElementById('chat-window');
 const closeBtn=document.getElementById('close-btn');
 const bodyEl=document.getElementById('chat-body');
 const form=document.getElementById('chat-input');
 const inputEl=document.getElementById('user-input');
 const sendBtn=document.getElementById('send-btn');
 let greeted=false;

 function toggleChat(show){
   win.classList.toggle('show',show);
   launcher.setAttribute('aria-expanded',show);
   if(show&&!greeted){
     addBot('ðŸ¤– Hello! I\'m here 24/7â€”ask me anything.');
     // quick reply buttons
     const quick=document.createElement('div');quick.className='msg bot';
     const wrap=document.createElement('div');wrap.style.display='flex';wrap.style.gap='6px';wrap.className='bubble';
     ['Pricing','Capabilities','Contact support'].forEach(t=>{
       const b=document.createElement('button');b.textContent=t;b.style.cssText='padding:4px 8px;border:1px solid var(--accent);background:#fff;color:var(--accent);border-radius:12px;font-size:12px;cursor:pointer';
       b.onclick=()=>{addUser(t);quick.remove();sendToBackend(t);} ;wrap.appendChild(b);
     });
     quick.appendChild(wrap);bodyEl.appendChild(quick);bodyEl.scrollTop=bodyEl.scrollHeight;
     greeted=true;
   }
   if(show) inputEl.focus();
 }
 launcher.addEventListener('click',()=>toggleChat(!win.classList.contains('show')));
 closeBtn.addEventListener('click',()=>toggleChat(false));
 window.addEventListener('keydown',e=>{if(e.key==='Escape')toggleChat(false)});

 function addBubble(text,cls){
   const msg=document.createElement('div');msg.className='msg '+cls;
   const bub=document.createElement('div');bub.className='bubble';bub.textContent=text;
   msg.appendChild(bub);bodyEl.appendChild(msg);bodyEl.scrollTop=bodyEl.scrollHeight;
 }
 function addUser(t){addBubble(t,'user');}
 function addBot(t){addBubble(t,'bot');}
 function showTyping(){
   const m=document.createElement('div');m.className='msg bot';
   const t=document.createElement('div');t.className='typing';
   t.innerHTML='<span></span><span></span><span></span>';m.appendChild(t);
   bodyEl.appendChild(m);bodyEl.scrollTop=bodyEl.scrollHeight;return m;
 }

 function isCompliment(t){return /(thank|thanks|thx|thank you)/i.test(t);}  

 async function sendToBackend(message){
   const typingEl=showTyping();sendBtn.disabled=true;
   try{
     const r=await fetch('/ask',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({question:message})});
     const {answer}=await r.json();
     typingEl.remove();
     if(!answer || /i\s(don't|dont) know|sorry/i.test(answer)){
       addBot(answer||'ðŸ˜• I\'m not sure.');
       addBot('Can I help you with something else?');
     }else{
       addBot(answer);
     }
   }catch(err){typingEl.remove();addBot('ðŸ˜• Sorry, something went wrong.');}
   sendBtn.disabled=false;
 }

 form.addEventListener('submit',async e=>{
   e.preventDefault();const txt=inputEl.value.trim();if(!txt) return;
   addUser(txt);
   inputEl.value='';inputEl.focus();
   if(isCompliment(txt)){
     addBot('You\'re welcome! ðŸ˜Š');return;
   }
   await sendToBackend(txt);
 });

 // auto-open after short delay
 setTimeout(()=>launcher.click(),600);
})();
</script>
</body>
</html>
